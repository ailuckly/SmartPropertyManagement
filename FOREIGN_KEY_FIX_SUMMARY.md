# å¤–é”®çº¦æŸé—®é¢˜ä¿®å¤æ€»ç»“

## ğŸš¨ é—®é¢˜åŸå› 

å¯åŠ¨æ—¶é‡åˆ°å¤–é”®çº¦æŸé”™è¯¯ï¼š
```
Referencing column 'recipient_id' and referenced column 'id' in foreign key constraint 'FKqnduwq6ix2pxx1add03905i1i' are incompatible.
```

**æ ¹æœ¬åŸå› **ï¼šé¡¹ç›®ä½¿ç”¨äº†JPAçš„ `@ManyToOne`ã€`@OneToMany` å…³è”æ³¨è§£ï¼ŒHibernateè‡ªåŠ¨ç”Ÿæˆç‰©ç†å¤–é”®çº¦æŸï¼Œè¿™**è¿åäº†é˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒ**ã€‚

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ç§»é™¤æ‰€æœ‰ç‰©ç†å¤–é”®çº¦æŸ

æŒ‰ç…§[ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹](https://github.com/alibaba/p3c)çš„å¼ºåˆ¶è¦æ±‚ï¼š
- ã€å¼ºåˆ¶ã€‘ä¸è¦ä½¿ç”¨å¤–é”®ä¸çº§è”ï¼Œä¸€åˆ‡å¤–é”®æ¦‚å¿µå¿…é¡»åœ¨åº”ç”¨å±‚è§£å†³

### 2. å®ä½“ç±»ä¿®æ”¹

**ä¿®æ”¹å‰**ï¼š
```java
@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name = "recipient_id", nullable = false)
private User recipient;
```

**ä¿®æ”¹å**ï¼š
```java
@Column(name = "recipient_id", nullable = false)
private Long recipientId;

@Column(name = "recipient_username", length = 50)  
private String recipientUsername; // å†—ä½™å­—æ®µï¼Œé¿å…å…³è”æŸ¥è¯¢
```

### 3. æ¶‰åŠçš„å®ä½“ç±»

âœ… **Notification.java** - ç§»é™¤Userå…³è”ï¼Œæ”¹ç”¨recipientId + recipientUsername
âœ… **Property.java** - ç§»é™¤Userå…³è”ï¼Œæ”¹ç”¨ownerId + ownerUsername  
âœ… **Lease.java** - ç§»é™¤Propertyå’ŒUserå…³è”ï¼Œæ”¹ç”¨ID + å†—ä½™å­—æ®µ
âœ… **MaintenanceRequest.java** - ç§»é™¤Propertyå’ŒUserå…³è”ï¼Œæ”¹ç”¨ID + å†—ä½™å­—æ®µ
âœ… **Payment.java** - ç§»é™¤Leaseå…³è”ï¼Œæ”¹ç”¨ID + å†—ä½™å­—æ®µ
âœ… **User.java** - è§’è‰²å…³è”ç¦ç”¨å¤–é”®çº¦æŸ

### 4. é…ç½®ä¼˜åŒ–

åœ¨ `application.properties` ä¸­æ·»åŠ ï¼š
```properties
# éµå¾ªé˜¿é‡Œå·´å·´è§„èŒƒï¼šç¦ç”¨ç‰©ç†å¤–é”®çº¦æŸ
spring.jpa.properties.hibernate.physical_naming_strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
spring.jpa.properties.hibernate.check_nullability=false
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

### Before âŒ
- Hibernateè‡ªåŠ¨åˆ›å»ºç‰©ç†å¤–é”®çº¦æŸ
- å¯åŠ¨æ—¶å¤–é”®åˆ›å»ºå¤±è´¥
- è¿åé˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒ

### After âœ…  
- æ— ç‰©ç†å¤–é”®çº¦æŸ
- åº”ç”¨æ­£å¸¸å¯åŠ¨
- éµå¾ªé˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒ
- æ€§èƒ½æ›´å¥½ï¼Œæ‰©å±•æ€§æ›´å¼º

## ğŸ”„ æ•°æ®ä¸€è‡´æ€§ä¿è¯

è™½ç„¶ç§»é™¤äº†ç‰©ç†å¤–é”®ï¼Œä½†é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼š

1. **åº”ç”¨å±‚æ ¡éªŒ**ï¼šåœ¨Serviceå±‚è¿›è¡Œå…³è”æ•°æ®æ£€æŸ¥
2. **å†—ä½™å­—æ®µ**ï¼šå­˜å‚¨å¸¸ç”¨çš„å…³è”æ•°æ®ï¼ˆå¦‚ç”¨æˆ·åã€åœ°å€ç­‰ï¼‰
3. **äº‹åŠ¡ç®¡ç†**ï¼šä½¿ç”¨ `@Transactional` ç¡®ä¿æ“ä½œåŸå­æ€§
4. **ä¸šåŠ¡é€»è¾‘**ï¼šé€šè¿‡ä»£ç é€»è¾‘ç»´æŠ¤æ•°æ®å®Œæ•´æ€§

## ğŸš€ å¥½å¤„

1. **æ€§èƒ½æå‡**ï¼šæ— å¤–é”®çº¦æŸï¼Œæ’å…¥å’Œåˆ é™¤é€Ÿåº¦æ›´å¿«
2. **é¿å…æ­»é”**ï¼šä¸ä¼šå› ä¸ºå¤–é”®çº¦æŸå¯¼è‡´çš„æ­»é”é—®é¢˜
3. **æ˜“äºæ‰©å±•**ï¼šä¾¿äºåˆ†åº“åˆ†è¡¨å’Œå¾®æœåŠ¡æ‹†åˆ†
4. **é£é™©å¯æ§**ï¼šé€šè¿‡åº”ç”¨å±‚é€»è¾‘ï¼Œæ›´çµæ´»åœ°å¤„ç†æ•°æ®ä¸€è‡´æ€§

## ğŸ“ æ³¨æ„äº‹é¡¹

âš ï¸ **é‡è¦**ï¼šç§»é™¤ç‰©ç†å¤–é”®åï¼Œéœ€è¦åœ¨åº”ç”¨å±‚ç‰¹åˆ«æ³¨æ„ï¼š

1. åˆ é™¤æ•°æ®å‰æ£€æŸ¥å…³è”å…³ç³»
2. æ›´æ–°å†—ä½™å­—æ®µä¿æŒæ•°æ®åŒæ­¥  
3. ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ“ä½œåŸå­æ€§
4. å®šæœŸè¿›è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

---

**ä¿®å¤å®Œæˆ**ï¼šç°åœ¨å¯ä»¥æ­£å¸¸å¯åŠ¨åº”ç”¨ï¼Œä¸”å®Œå…¨ç¬¦åˆé˜¿é‡Œå·´å·´å¼€å‘è§„èŒƒ âœ…