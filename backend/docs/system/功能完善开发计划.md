# 智慧物业管理系统 - 功能完善开发计划

> 创建日期：2025-10-14
> 项目状态：核心功能已完成，进入功能完善阶段

---

## 📊 当前系统状态

### ✅ 已完成功能

#### 核心业务模块
- [x] 用户注册/登录/登出
- [x] 基于角色的权限控制（管理员、业主、租户）
- [x] 物业管理（增删改查、筛选、分页）
- [x] 租约管理（创建、更新、状态管理）
- [x] 维修管理（请求提交、状态跟踪）
- [x] 收支记录管理
- [x] 数据可视化仪表盘（7类图表）

#### 技术特性
- [x] JWT Token 认证
- [x] Spring Security 安全框架
- [x] Vue 3 + Element Plus UI
- [x] ECharts 数据可视化
- [x] 响应式布局
- [x] 弹窗式表单操作

---

## 🎯 功能完善开发计划

按优先级和依赖关系排序，逐步实现以下功能。

---

## 第一阶段：核心体验提升（高优先级）

### 1. 用户个人资料管理 ⭐⭐⭐⭐⭐

**开发时间**：2-3 小时
**状态**：🔴 待开始

#### 功能描述
用户可以查看和编辑个人信息，修改密码，提升账户安全性。

#### 子任务清单
- [ ] 后端：用户资料 API
  - [ ] GET `/api/users/profile` - 获取当前用户资料
  - [ ] PUT `/api/users/profile` - 更新用户资料
  - [ ] PUT `/api/users/change-password` - 修改密码
  - [ ] UserController 添加相关方法
  - [ ] 密码加密验证逻辑

- [ ] 前端：用户资料页面
  - [ ] 创建 `ProfileView.vue` 页面
  - [ ] 用户信息展示卡片
  - [ ] 编辑资料表单（用户名、邮箱、手机号）
  - [ ] 修改密码表单（旧密码、新密码、确认密码）
  - [ ] 表单验证逻辑
  - [ ] 添加到路由和菜单

#### 技术要点
- 密码修改需验证旧密码
- 新密码需要加密存储（BCrypt）
- 前端表单验证（密码强度、确认密码一致性）
- 更新成功后需要提示用户

#### 验收标准
- [x] 用户可以查看自己的资料
- [x] 用户可以修改用户名、邮箱、手机号
- [x] 用户可以修改密码（验证旧密码）
- [x] 修改后信息立即生效
- [x] 所有操作有成功/失败提示

---

### 2. 数据导出功能 ⭐⭐⭐⭐⭐

**开发时间**：2-3 小时
**状态**：🔴 待开始

#### 功能描述
业主和管理员可以导出各类数据为 Excel 文件，便于离线分析和报表制作。

#### 子任务清单
- [ ] 后端：数据导出 API
  - [ ] 添加 Apache POI 依赖（Excel 生成库）
  - [ ] GET `/api/properties/export` - 导出物业列表
  - [ ] GET `/api/leases/export` - 导出租约列表
  - [ ] GET `/api/payments/export` - 导出收支记录
  - [ ] GET `/api/maintenance-requests/export` - 导出维修记录
  - [ ] ExcelExportService 工具类
  - [ ] 根据用户角色过滤导出数据

- [ ] 前端：导出按钮和功能
  - [ ] 物业列表页添加"导出"按钮
  - [ ] 租约列表页添加"导出"按钮
  - [ ] 收支记录页添加"导出"按钮
  - [ ] 维修记录页添加"导出"按钮
  - [ ] 文件下载处理逻辑
  - [ ] 导出中加载状态提示

#### 技术要点
- 使用 Apache POI 生成 Excel 文件
- 返回 `application/vnd.ms-excel` Content-Type
- 文件名包含时间戳（如：物业列表_2025-10-14.xlsx）
- 前端使用 Blob 和 URL.createObjectURL 下载
- 大数据量时考虑分页导出或异步导出

#### 验收标准
- [x] 可以导出物业列表（包含所有字段）
- [x] 可以导出租约列表（包含关联信息）
- [x] 可以导出收支记录
- [x] 可以导出维修记录
- [x] Excel 格式正确，中文不乱码
- [x] 文件名包含导出时间
- [x] 根据用户角色过滤数据

---

### 3. 搜索功能增强 ⭐⭐⭐⭐

**开发时间**：2-3 小时
**状态**：🔴 待开始

#### 功能描述
增强搜索体验，支持全局搜索和高级筛选。

#### 子任务清单
- [ ] 后端：搜索 API 增强
  - [ ] 物业搜索：支持地址、城市、邮编关键词搜索
  - [ ] 租约搜索：支持租户姓名、物业地址搜索
  - [ ] 维修搜索：支持描述关键词搜索
  - [ ] 添加 LIKE 查询支持
  - [ ] 支持多条件组合搜索

- [ ] 前端：搜索 UI 优化
  - [ ] 各列表页添加搜索框
  - [ ] 实时搜索（防抖）
  - [ ] 搜索关键词高亮
  - [ ] 高级筛选面板（可展开/折叠）
  - [ ] 清空搜索按钮
  - [ ] 搜索无结果提示

#### 技术要点
- 后端使用 JPA 的 `Containing` 关键字（LIKE %keyword%）
- 前端使用 lodash.debounce 或自定义防抖
- 搜索参数传递使用 Query String
- 保持现有筛选功能，搜索是额外维度

#### 验收标准
- [x] 可以通过关键词搜索物业地址
- [x] 可以通过租户姓名搜索租约
- [x] 可以通过关键词搜索维修请求
- [x] 搜索结果实时更新（500ms 防抖）
- [x] 清空搜索恢复完整列表
- [x] 搜索和筛选可以组合使用

---

## 第二阶段：功能完善（中优先级）

### 4. 通知系统 ⭐⭐⭐⭐

**开发时间**：4-5 小时
**状态**：🔴 待开始

#### 功能描述
用户可以收到系统通知，如租约到期提醒、维修状态变更等。

#### 子任务清单
- [ ] 后端：通知系统
  - [ ] 创建 Notification 实体和表
  - [ ] NotificationRepository 和 Service
  - [ ] GET `/api/notifications` - 获取通知列表
  - [ ] PUT `/api/notifications/{id}/read` - 标记为已读
  - [ ] DELETE `/api/notifications/{id}` - 删除通知
  - [ ] 通知生成逻辑（租约到期、维修状态变更等）
  - [ ] 定时任务扫描并生成通知

- [ ] 前端：通知中心
  - [ ] 顶部导航栏添加通知图标（带未读数量徽章）
  - [ ] 通知下拉面板（最新5条）
  - [ ] 通知中心页面（完整通知列表）
  - [ ] 标记已读功能
  - [ ] 删除通知功能
  - [ ] 通知类型图标和颜色区分

#### 技术要点
- 通知类型：INFO、WARNING、ERROR、SUCCESS
- 通知分类：租约、维修、收支、系统
- 使用 Spring @Scheduled 定时任务
- 前端轮询或 WebSocket 实时通知（可选）
- Element Plus Badge 组件显示未读数量

#### 验收标准
- [x] 租约到期前7天自动生成提醒
- [x] 维修状态变更时通知相关用户
- [x] 顶部导航显示未读通知数量
- [x] 可以查看通知详情
- [x] 可以标记已读/未读
- [x] 可以删除通知

---

### 5. 文件上传功能 ⭐⭐⭐⭐

**开发时间**：4-5 小时
**状态**：🔴 待开始

#### 功能描述
支持上传物业图片、租约合同、维修请求图片等文件。

#### 子任务清单
- [ ] 后端：文件上传 API
  - [ ] 配置文件上传路径（application.yml）
  - [ ] POST `/api/files/upload` - 通用文件上传接口
  - [ ] GET `/api/files/{filename}` - 文件访问接口
  - [ ] FileStorageService - 文件存储服务
  - [ ] 文件类型和大小验证
  - [ ] 文件名UUID重命名（避免冲突）
  - [ ] 文件与实体关联（如物业、维修请求）

- [ ] 数据库：文件记录表
  - [ ] 创建 File 实体（文件名、路径、大小、类型、关联实体ID）
  - [ ] FileRepository

- [ ] 前端：文件上传组件
  - [ ] 物业表单添加图片上传（最多5张）
  - [ ] 维修请求表单添加图片上传（最多3张）
  - [ ] 租约表单添加合同上传（PDF、Word）
  - [ ] 图片预览功能
  - [ ] 文件删除功能
  - [ ] 上传进度显示

#### 技术要点
- 后端使用 MultipartFile 接收上传
- 文件存储在服务器 `/uploads` 目录
- 图片类型限制：jpg、png、gif（最大5MB）
- 文档类型限制：pdf、doc、docx（最大10MB）
- 前端使用 Element Plus Upload 组件
- 图片预览使用 Image Viewer

#### 验收标准
- [x] 可以为物业上传图片
- [x] 可以为维修请求上传图片
- [x] 可以为租约上传合同文件
- [x] 上传时验证文件类型和大小
- [x] 可以预览已上传的图片
- [x] 可以删除已上传的文件
- [x] 文件安全存储，不可直接访问原始路径

---

### 6. 批量操作 ⭐⭐⭐

**开发时间**：2-3 小时
**状态**：🔴 待开始

#### 功能描述
支持批量删除、批量导出、批量更新状态等操作，提高管理效率。

#### 子任务清单
- [ ] 后端：批量操作 API
  - [ ] DELETE `/api/properties/batch` - 批量删除物业
  - [ ] DELETE `/api/leases/batch` - 批量删除租约
  - [ ] PUT `/api/maintenance-requests/batch-status` - 批量更新维修状态
  - [ ] RequestBody 接收 ID 数组

- [ ] 前端：批量操作 UI
  - [ ] 表格添加多选列（Checkbox）
  - [ ] 顶部添加批量操作按钮栏
  - [ ] 批量删除（带二次确认）
  - [ ] 批量导出选中项
  - [ ] 批量更新状态（维修请求）
  - [ ] 显示已选中数量
  - [ ] 全选/反选功能

#### 技术要点
- 表格使用 Element Plus Table 的 `selection` 列
- 批量操作前进行二次确认
- 后端使用事务保证原子性
- 批量操作失败时回滚
- 操作完成后刷新列表

#### 验收标准
- [x] 可以批量删除物业
- [x] 可以批量删除租约
- [x] 可以批量更新维修状态
- [x] 批量操作有二次确认
- [x] 显示已选中的数量
- [x] 操作失败时有明确提示

---

### 7. 审计日志 ⭐⭐⭐

**开发时间**：3-4 小时
**状态**：🔴 待开始

#### 功能描述
记录系统操作日志，便于追踪和审计。

#### 子任务清单
- [ ] 后端：审计日志系统
  - [ ] 创建 AuditLog 实体（操作人、操作类型、操作对象、时间、IP 地址）
  - [ ] AuditLogRepository 和 Service
  - [ ] @AuditLog 自定义注解
  - [ ] AOP 切面自动记录操作
  - [ ] GET `/api/audit-logs` - 查询日志（仅管理员）
  - [ ] 记录增删改操作

- [ ] 前端：审计日志页面
  - [ ] 创建 `AuditLogsView.vue`（仅管理员可见）
  - [ ] 日志列表展示（表格）
  - [ ] 按操作类型、用户、时间筛选
  - [ ] 日志详情查看
  - [ ] 日志导出

#### 技术要点
- 使用 Spring AOP 拦截 Controller 方法
- 从 HttpServletRequest 获取 IP 地址
- 记录请求参数和响应结果（脱敏）
- 异步记录日志（不影响业务性能）
- 定期清理过期日志

#### 验收标准
- [x] 记录物业、租约、维修、收支的增删改操作
- [x] 记录操作人、操作时间、IP 地址
- [x] 管理员可以查询审计日志
- [x] 可以按条件筛选日志
- [x] 可以导出日志

---

## 第三阶段：体验优化（低优先级）

### 8. 深色模式 ⭐⭐

**开发时间**：2-3 小时
**状态**：🔴 待开始

#### 功能描述
支持亮色/深色主题切换，提升不同场景下的使用体验。

#### 子任务清单
- [ ] 前端：主题切换
  - [ ] 顶部导航添加主题切换按钮
  - [ ] 使用 Element Plus 深色主题
  - [ ] 自定义组件深色样式
  - [ ] ECharts 图表深色主题
  - [ ] 主题偏好保存到 localStorage
  - [ ] 页面加载时恢复主题偏好

#### 技术要点
- Element Plus 内置 `dark` 主题
- 使用 CSS 变量定义颜色
- ECharts 切换为 `dark` 主题
- Pinia store 管理主题状态

#### 验收标准
- [x] 可以切换亮色/深色主题
- [x] 所有页面适配深色主题
- [x] 图表支持深色主题
- [x] 主题偏好持久化保存
- [x] 页面刷新后主题保持

---

### 9. 移动端优化 ⭐⭐

**开发时间**：4-5 小时
**状态**：🔴 待开始

#### 功能描述
优化移动设备访问体验，适配小屏幕。

#### 子任务清单
- [ ] 前端：移动端适配
  - [ ] 响应式菜单（汉堡菜单）
  - [ ] 表格移动端优化（卡片式布局）
  - [ ] 表单移动端优化
  - [ ] 图表移动端适配
  - [ ] 触摸手势支持
  - [ ] 移动端导航优化

#### 技术要点
- 使用 CSS Media Queries
- Element Plus 组件自动响应式
- 移动端使用 Drawer 替代 Dialog
- 表格在移动端使用卡片列表
- 图表自适应容器宽度

#### 验收标准
- [x] 移动端菜单可正常使用
- [x] 表格在移动端可读性好
- [x] 表单在移动端易于填写
- [x] 图表在移动端显示正常
- [x] 触摸操作流畅

---

### 10. 统计报表 ⭐⭐⭐

**开发时间**：5-6 小时
**状态**：🔴 待开始

#### 功能描述
提供更详细的统计报表和数据分析功能。

#### 子任务清单
- [ ] 后端：统计报表 API
  - [ ] GET `/api/reports/monthly` - 月度统计报表
  - [ ] GET `/api/reports/yearly` - 年度统计报表
  - [ ] GET `/api/reports/occupancy-rate` - 出租率统计
  - [ ] GET `/api/reports/revenue-analysis` - 收益分析
  - [ ] 复杂 SQL 查询或聚合

- [ ] 前端：报表页面
  - [ ] 创建 `ReportsView.vue`
  - [ ] 月度/年度切换
  - [ ] 出租率趋势图
  - [ ] 收益对比图
  - [ ] 报表导出 PDF
  - [ ] 时间范围选择器

#### 技术要点
- 使用 JPA 原生查询或 Criteria API
- 复杂数据聚合计算
- 前端使用多种图表类型
- 报表数据缓存优化
- PDF 导出使用 jsPDF 库

#### 验收标准
- [x] 可以查看月度统计报表
- [x] 可以查看年度统计报表
- [x] 出租率趋势图准确
- [x] 收益分析详细
- [x] 可以导出报表为 PDF

---

## 📅 开发时间表

### 第一阶段（约 7-9 小时）
- 功能 1：用户个人资料管理（2-3 小时）
- 功能 2：数据导出功能（2-3 小时）
- 功能 3：搜索功能增强（2-3 小时）

**预计完成时间**：2-3 天（每天3小时工作量）

### 第二阶段（约 13-17 小时）
- 功能 4：通知系统（4-5 小时）
- 功能 5：文件上传功能（4-5 小时）
- 功能 6：批量操作（2-3 小时）
- 功能 7：审计日志（3-4 小时）

**预计完成时间**：4-6 天

### 第三阶段（约 13-17 小时）
- 功能 8：深色模式（2-3 小时）
- 功能 9：移动端优化（4-5 小时）
- 功能 10：统计报表（5-6 小时）

**预计完成时间**：4-6 天

**总计开发时间**：33-43 小时（约 10-15 天）

---

## 🎯 里程碑

- **里程碑 1**：第一阶段完成 - 基础体验提升
- **里程碑 2**：第二阶段完成 - 功能完善
- **里程碑 3**：第三阶段完成 - 全面优化

---

## 📝 注意事项

1. **渐进式开发**：每完成一个功能立即测试，确保不影响现有功能
2. **代码审查**：每个功能完成后进行代码审查
3. **文档更新**：及时更新 API 文档和用户手册
4. **数据备份**：重大修改前备份数据库
5. **Git 提交**：每个功能独立提交，便于回滚和追踪

---

## 🔄 进度追踪

当前进度：**0/10 功能完成** (0%)

- [ ] 功能 1：用户个人资料管理
- [ ] 功能 2：数据导出功能
- [ ] 功能 3：搜索功能增强
- [ ] 功能 4：通知系统
- [ ] 功能 5：文件上传功能
- [ ] 功能 6：批量操作
- [ ] 功能 7：审计日志
- [ ] 功能 8：深色模式
- [ ] 功能 9：移动端优化
- [ ] 功能 10：统计报表

---

**最后更新**：2025-10-14
**负责人**：开发团队
**版本**：v1.0
